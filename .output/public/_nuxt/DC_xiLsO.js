import{X as L,i as m,l as k,d as D,u as E,o as F,z as n,A as e,L as a,E as _,B as i,V as v,T as A,Y as T,Q as O,O as z,P as N,Z as P,y as o}from"./CvPgl9uc.js";import{u as W}from"./D-FryafY.js";const $=L("credits",()=>{const f=m("0"),h=m(null),l=m(!1),t=m(null),c=k(()=>parseFloat(f.value)||0),d=k(()=>{const r=c.value;return r>20?"good":r>=10?"warning":"critical"});async function b(){l.value=!0,t.value=null;try{const r=await $fetch("/api/credits/balance");f.value=r.balance,h.value=r.lastRechargedAt}catch(r){const u=r;t.value=u.message||"Fehler beim Laden des Guthabens"}finally{l.value=!1}}async function p(r){l.value=!0,t.value=null;try{const u=await $fetch("/api/credits/recharge",{method:"POST",body:{amount:r}});return u.success?(f.value=u.newBalance,h.value=new Date().toISOString(),{success:!0}):{success:!1,error:u.message}}catch(u){const w=u.data?.message||"Fehler beim Aufladen";return t.value=w,{success:!1,error:w}}finally{l.value=!1}}async function S(){l.value=!0,t.value=null;try{const r=await $fetch("/api/credits/monthly",{method:"POST"});return r.success?(f.value=r.newBalance,h.value=new Date().toISOString(),{success:!0}):{success:!1,error:r.message}}catch(r){const x=r.data?.message||"Fehler bei Monatspauschale";return t.value=x,{success:!1,error:x}}finally{l.value=!1}}return{balance:f,lastRechargedAt:h,isLoading:l,error:t,balanceNumeric:c,balanceStatus:d,fetchBalance:b,recharge:p,receiveMonthly:S}}),j={class:"min-h-screen bg-background p-8"},V={class:"max-w-4xl mx-auto"},I={class:"flex justify-between items-center mb-8"},H={key:0,class:"text-sm text-muted-foreground mt-1"},K={key:0},Z={class:"ml-2 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded"},J={class:"grid gap-6 mb-8"},Q={class:"flex items-center justify-between mb-4"},X={class:"text-4xl font-bold","aria-labelledby":"balance-label"},Y={"aria-live":"polite"},q=["aria-label"],U={class:"flex gap-3"},ee=["disabled"],te=["disabled"],ae={key:0,class:"text-xs mt-3 opacity-70"},se={key:1,class:"text-xs mt-3 text-red-600 bg-red-50 p-2 rounded",role:"alert"},re={class:"bg-background rounded-lg max-w-md w-full p-6 border shadow-xl"},le={key:0,class:"text-center py-8",role:"status","aria-live":"polite"},oe={key:1,class:"text-center py-8"},ne={key:2},ie={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",role:"alert"},de={class:"grid grid-cols-3 gap-3 mb-6",role:"group","aria-label":"Auflade-Beträge auswählen"},ue=["onClick","aria-pressed"],ce={class:"text-2xl font-bold"},be={class:"text-xs text-muted-foreground"},me=["disabled"],pe=D({__name:"dashboard",setup(f){const h=E(),l=W(),t=$(),c=m(!1),d=m(null),b=m(!1),p=m(!1),S=[{amount:"10",label:"10 €",description:"Klein"},{amount:"25",label:"25 €",description:"Standard"},{amount:"50",label:"50 €",description:"Groß"}],r=k(()=>{switch(t.balanceStatus){case"good":return"bg-green-100 border-green-300 text-green-800";case"warning":return"bg-yellow-100 border-yellow-300 text-yellow-800";case"critical":return"bg-red-100 border-red-300 text-red-800";default:return"bg-gray-100 border-gray-300 text-gray-800"}}),u=k(()=>{switch(t.balanceStatus){case"good":return"bg-green-500";case"warning":return"bg-yellow-500";case"critical":return"bg-red-500";default:return"bg-gray-500"}}),x=()=>{l.logout()},w=y=>{d.value=y},B=async()=>{if(!d.value||b.value)return;b.value=!0,p.value=!1,await new Promise(s=>setTimeout(s,2e3+Math.random()*1e3));const y=await t.recharge(d.value);b.value=!1,y.success&&(p.value=!0,setTimeout(()=>{c.value=!1,p.value=!1,d.value=null},1500))},G=async()=>{t.isLoading||await t.receiveMonthly()},M=()=>{t.error=null},C=()=>{c.value=!1,d.value=null,t.error=null},R=y=>{y.key==="Escape"&&c.value&&C()};return F(async()=>{await l.initFromCookie(),l.user?await t.fetchBalance():h.push("/login"),typeof window<"u"&&window.addEventListener("keydown",R)}),(y,s)=>(o(),n("div",j,[e("div",V,[e("div",I,[e("div",null,[s[1]||(s[1]=e("h1",{class:"text-3xl font-bold text-primary"},"Dashboard",-1)),a(l).user?(o(),n("p",H,[_(" Angemeldet als "+i(a(l).user.name)+" ",1),a(l).user.location?(o(),n("span",K,"("+i(a(l).user.location)+")",1)):v("",!0),e("span",Z,i(a(l).user.role),1)])):v("",!0)]),e("button",{onClick:x,class:"py-2 px-4 border border-primary text-primary rounded-lg font-medium hover:bg-primary/10 transition-colors"}," Abmelden ")]),e("div",J,[e("div",{class:A(["rounded-lg p-6 border-2 transition-all",a(r)]),role:"status","aria-live":"polite"},[e("div",Q,[e("div",null,[s[3]||(s[3]=e("p",{class:"text-sm font-medium opacity-80",id:"balance-label"},"Guthaben",-1)),e("p",X,[e("span",Y,i(a(t).balance),1),s[2]||(s[2]=_(" € ",-1))])]),e("div",{class:A(["w-4 h-4 rounded-full",a(u)]),role:"img","aria-label":"Guthaben-Status: "+a(t).balanceStatus},null,10,q)]),e("div",U,[e("button",{onClick:s[0]||(s[0]=g=>c.value=!0),disabled:a(t).isLoading,"aria-label":"Guthaben aufladen",class:"flex-1 py-3 px-4 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Guthaben aufladen ",8,ee),e("button",{onClick:G,disabled:a(t).isLoading,"aria-label":"Monatspauschale erhalten, erhöht Guthaben um 25 Euro",class:"flex-1 py-3 px-4 border-2 border-current rounded-lg font-medium hover:bg-white/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},i(a(t).isLoading?"Wird geladen...":"Monatspauschale +25€"),9,te)]),a(t).lastRechargedAt?(o(),n("p",ae," Zuletzt aufgeladen: "+i(new Date(a(t).lastRechargedAt).toLocaleDateString("de-DE")),1)):v("",!0),a(t).error?(o(),n("p",se,[_(i(a(t).error)+" ",1),e("button",{onClick:M,class:"ml-2 underline","aria-label":"Fehlermeldung schließen"},"✕")])):v("",!0)],2)]),s[4]||(s[4]=e("div",{class:"bg-card rounded-lg p-6 border"},[e("p",{class:"text-foreground"},"Willkommen im Admin-Dashboard!"),e("p",{class:"text-muted-foreground mt-2"},"Hier werden später die Admin-Funktionen angezeigt.")],-1))]),(o(),T(P,{to:"body"},[a(c)?(o(),n("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:O(C,["self"]),role:"dialog","aria-modal":"true","aria-labelledby":"modal-title"},[e("div",re,[e("div",{class:"flex justify-between items-center mb-6"},[s[5]||(s[5]=e("h2",{id:"modal-title",class:"text-xl font-bold"},"Guthaben aufladen",-1)),e("button",{onClick:C,class:"text-muted-foreground hover:text-foreground p-1","aria-label":"Modal schließen"}," ✕ ")]),a(p)?(o(),n("div",le,[...s[6]||(s[6]=[e("div",{class:"text-4xl mb-4","aria-hidden":"true"},"✓",-1),e("p",{class:"text-lg font-medium text-green-600"},"Guthaben erfolgreich aufgeladen!",-1)])])):a(b)?(o(),n("div",oe,[...s[7]||(s[7]=[e("div",{class:"mb-4"},[e("div",{class:"h-2 bg-gray-200 rounded-full overflow-hidden"},[e("div",{class:"h-full bg-primary transition-all duration-300",style:{width:"100%"}})])],-1),e("p",{class:"text-lg font-medium"},"Wird aufgeladen...",-1)])])):(o(),n("div",ne,[s[8]||(s[8]=e("p",{class:"text-sm text-muted-foreground mb-4"},"Wähle einen Betrag:",-1)),a(t).error?(o(),n("div",ie,[_(i(a(t).error)+" ",1),e("button",{onClick:M,class:"ml-2 underline","aria-label":"Fehlermeldung schließen"},"✕")])):v("",!0),e("div",de,[(o(),n(z,null,N(S,g=>e("button",{key:g.amount,onClick:ge=>w(g.amount),"aria-pressed":a(d)===g.amount,class:A(["p-4 rounded-lg border-2 transition-all text-center",a(d)===g.amount?"border-primary bg-primary/10":"border-border hover:border-primary/50"])},[e("p",ce,i(g.label),1),e("p",be,i(g.description),1)],10,ue)),64))]),e("button",{onClick:B,disabled:!a(d)||a(b),"aria-label":"Guthaben mit gewählten Betrag aufladen",class:"w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},i(a(b)?"Wird aufgeladen...":"Jetzt aufladen"),9,me)]))])])):v("",!0)]))]))}});export{pe as default};
